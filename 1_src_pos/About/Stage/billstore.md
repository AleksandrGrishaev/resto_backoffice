–î–∞–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–∏–º –Ω–∞—à –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã:

# –ü—Ä–æ–¥–µ–ª–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞:

- [x] –°–æ–∑–¥–∞–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–æ–≤–æ–≥–æ BillStore
- [x] –†–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–ª–∏ —Ç–∏–ø—ã –ø–æ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Å—Ç–æ—Ä–∞—Ö
- [x] –î–æ–±–∞–≤–∏–ª–∏ BillStore –≤ Debug Store View
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–ª–∏ –∫–æ–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º #regions

# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∏–ø–æ–≤ ‚úì

```tsx
typescript
Copy
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã bill.ts - —Ç–∏–ø—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—á–µ—Ç–∞–º–∏
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã order.ts - —Ç–∏–ø—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã table.ts - —Ç–∏–ø—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–æ–ª–∞–º–∏

```

1. BillStore ‚è≥

```tsx
typescript
Copy
- [x] –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–æ—Ä–∞
- [x] State management (activeBill, selection, history)
- [x] Computed properties –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
- [x] Selection methods
- [ ] –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ (–ø–µ—Ä–µ–Ω–æ—Å –∏–∑ OrderStore)
- [ ] –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π

```

1. OrderStore Refactoring üîÑ

```tsx
typescript
Copy
- [ ] –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (Map –¥–ª—è –∑–∞–∫–∞–∑–æ–≤)
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è

```

1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ üìã

```tsx
typescript
Copy
- [ ] BillsManager.vue
- [ ] OrderSection.vue
- [ ] OrderActions.vue
- [ ] MoveBillsDialog.vue
- [ ] MoveItemsDialog.vue
- [ ] MoveOrderDialog.vue

```

1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ üß™

```tsx
typescript
Copy
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

```

–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ –≤ BillStore
2. –ù–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ OrderStore
3. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –ø–æ–∫–∞–∑–∞–ª —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–∫–æ–≥–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —à–∞–≥–∞?

graph TD
A[TableStore] -- "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–∞–º–∏" --> B[OrderStore]
B -- "–ê–∫—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑" --> C[BillStore]

```
subgraph TableStore
    T1[Tables] -- "—Å–≤—è–∑—å" --> T2[TableStatus]
    T2 -- "currentOrderId" --> B
end

subgraph OrderStore ["OrderStore (Single Source of Truth)"]
    O1[Orders Map] -- "—Å–æ–¥–µ—Ä–∂–∏—Ç" --> O2[Order Data]
    O2 -- "—Å–æ–¥–µ—Ä–∂–∏—Ç" --> O3[Bills Array]
    O4[Active Order ID] -- "—É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞" --> O2
end

subgraph BillStore
    B1[Active Bill] -- "—Å—Å—ã–ª–∫–∞ –Ω–∞" --> O3
    B2[Selection State]
    B3[Unsaved Changes]
end

subgraph Components
    C1[BillsManager] -- "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç" --> B
    C2[OrderSection] -- "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç" --> B
    C3[TablesSidebar] -- "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç" --> A
end

```

# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã POS —Å–∏—Å—Ç–µ–º—ã

## 1. –°–æ–∑–¥–∞–Ω–∏–µ BillStore

### 1.1 –ù–æ–≤—ã–π —Å—Ç–æ—Ä (bill.store.ts)

```tsx
export const useBillStore = defineStore('bill', () => {
  // State
  const activeBill = ref<Bill | null>(null)
  const selection = ref<SelectableState>({
    selectedItems: new Set<string>(),
    selectedBills: new Set<string>(),
    selectionMode: 'none' as SelectionMode
  })
  const hasUnsavedChanges = ref(false)

  // –ì–µ—Ç—Ç–µ—Ä—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
  const billSubtotal = computed(() => {...})
  const billTaxes = computed(() => {...})
  const billTotal = computed(() => {...})

  // –ú–µ—Ç–æ–¥—ã –≤—ã–¥–µ–ª–µ–Ω–∏—è
  const toggleItemSelection = (itemId: string) => {...}
  const toggleBillSelection = (billId: string) => {...}
  const clearSelection = () => {...}
  const hasSelection = computed(() => {...})

  // –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ç–∏–≤–Ω—ã–º —Å—á–µ—Ç–æ–º
  const setActiveBill = (bill: Bill) => {...}
  const updateActiveBill = (data: Partial<Bill>) => {...}
  const validateChanges = (): ValidationResult => {...}

  return {...}
})

```

### 1.2 –ü–µ—Ä–µ–Ω–æ—Å–∏–º—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ OrderStore

- –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å selection
- –ú–µ—Ç–æ–¥—ã —Ä–∞—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤ (subtotal, taxes, total)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—á–µ—Ç–∞
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—á–µ—Ç–∞

## 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ OrderStore

### 2.1 –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```tsx
export const useOrderStore = defineStore('order', () => {
  // State
  const orders = ref<Map<string, Order>>(new Map())
  const activeOrderId = ref<string | null>(null)
  const ordersData = ref<Map<string, TableOrderData>>(new Map())

  // –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
  const createOrder = (type: OrderType, tableId: string): string => {...}
  const updateOrder = (orderId: string, data: Partial<Order>): void => {...}
  const deleteOrder = (orderId: string): void => {...}

  // –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å–æ —Å—á–µ—Ç–∞–º–∏
  const addBill = (orderId: string): string => {...}
  const updateBill = (orderId: string, billId: string, data: Partial<Bill>) => {...}
  const moveBill = (billId: string, targetOrderId: string) => {...}
  const mergeBills = (orderId: string) => {...}

  // –ú–µ—Ç–æ–¥—ã –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
  const moveOrderToTable = (orderId: string, tableId: string) => {...}
  const changeOrderType = (orderId: string, type: OrderType) => {...}
  const moveBillToTable = (billId: string, tableId: string) => {...}

  return {...}
})

```

### 2.2 –£–¥–∞–ª—è–µ–º—ã–µ –º–µ—Ç–æ–¥—ã

- –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å selection
- –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ç–∏–≤–Ω—ã–º —Å—á–µ—Ç–æ–º
- –ú–µ—Ç–æ–¥—ã —Ä–∞—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤

## 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ UI

### 3.1 BillsManager.vue

```tsx
// –ë—ã–ª–æ
const orderStore = useOrderStore()
const { selection, toggleItemSelection } = orderStore

// –°—Ç–∞–ª–æ
const orderStore = useOrderStore()
const billStore = useBillStore()
const { selection, toggleItemSelection } = billStore
```

### 3.2 OrderSection.vue

```tsx
// –ë—ã–ª–æ
const { bills, activeBill, orderTotal } = useOrderStore()

// –°—Ç–∞–ª–æ
const orderStore = useOrderStore()
const billStore = useBillStore()
const { activeBill, billTotal } = billStore
const bills = computed(() => orderStore.getOrderBills(orderStore.activeOrderId))
```

### 3.3 MoveBillsDialog.vue

```tsx
// –ë—ã–ª–æ
const handleMove = async ({ type, tableId }: { type: DeliveryType; tableId?: string }) => {
  await orderStore.moveBill(...)
}

// –°—Ç–∞–ª–æ
const handleMove = async ({ type, tableId }: { type: DeliveryType; tableId?: string }) => {
  await orderStore.moveBillToTable(billStore.activeBill.id, tableId)
}

```

### 3.4 MoveItemsDialog.vue

```tsx
// –ë—ã–ª–æ
const handleMoveItems = async ({ targetBillId }: { targetBillId: string }) => {
  for (const itemId of orderStore.selection.selectedItems) {
    await orderStore.moveItem(itemId, activeBill.value.id, targetBillId)
  }
}

// –°—Ç–∞–ª–æ
const handleMoveItems = async ({ targetBillId }: { targetBillId: string }) => {
  for (const itemId of billStore.selection.selectedItems) {
    await orderStore.moveItem(billStore.activeBill.id, targetBillId, itemId)
  }
}
```

## 4. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. –°–æ–∑–¥–∞–Ω–∏–µ BillStore
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   - –ü–µ—Ä–µ–Ω–æ—Å –º–µ—Ç–æ–¥–æ–≤ selection
   - –ü–µ—Ä–µ–Ω–æ—Å –º–µ—Ç–æ–¥–æ–≤ —Ä–∞—Å—á–µ—Ç–∞
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ OrderStore
   - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å BillStore
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - BillsManager.vue
   - OrderSection.vue
   - OrderActions.vue
   - MoveBillsDialog.vue
   - MoveItemsDialog.vue
   - MoveOrderDialog.vue
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

## 5. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

1. –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å selection –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ BillStore
2. OrderStore —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
3. UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Ç–æ—Ä—ã
4. –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
5. –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

## 6. –†–∏—Å–∫–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

1. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
   - –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å—Ç–æ—Ä–∞–º–∏
   - –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–∞—Ö
   - –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å –æ—Ç–º–µ–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–π
2. –ú–∏—Ç–∏–≥–∞—Ü–∏—è:
   - –¢—â–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

## 7. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—Ç–º–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏–π (undo/redo)
2. –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π
3. –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–æ–≤
