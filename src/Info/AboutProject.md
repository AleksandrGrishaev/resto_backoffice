# Руководство по разработке

## Структура веток

```
main   ●───●───●   (основная ветка, стабильный код)
         │   │
dev     ●───●───●  (ветка разработки)
           │   │
feature      ●───● (ветки для новых функций)
```

## Работа с ветками

### Основные команды

```bash
# Посмотреть все ветки (включая удаленные)
git branch -a

# Посмотреть все удаленные ветки
git branch -r

# Посмотреть текущую ветку
git branch --show-current

# Детальная информация о ветках
git branch -v    # показывает последний коммит в каждой ветке
git branch -vv   # показывает связь с удаленными ветками
```

### Настройка веток

```bash
# Убедимся что мы на main и он актуален
git checkout main
git pull

# Создаем ветку dev
git checkout -b dev

# Пушим ветку dev в удаленный репозиторий
git push --set-upstream origin dev
```

## Процесс разработки

### 1. Начало работы над задачей

```bash
git checkout dev                     # Переключаемся на dev
git pull                            # Получаем последние изменения
git checkout -b feature/task-name   # Создаем ветку для задачи
```

### 2. Во время разработки

```bash
git add .                           # Добавляем изменения
git commit -m "feat: описание"      # Коммитим
git push                           # Пушим изменения
```

### 3. Завершение задачи

```bash
git checkout dev                    # Переключаемся на dev
git pull                           # Подтягиваем изменения
git merge feature/task-name        # Сливаем нашу задачу
git push                          # Отправляем изменения
```

### 4. Релиз

```bash
git checkout main
git merge dev
pnpm release "описание релиза"
```

## Релизы

Для создания релиза используется скрипт `release.sh`:

```bash
pnpm release "описание релиза"
```

Скрипт автоматически:

- Добавляет все изменения
- Создает коммит с вашим сообщением
- Увеличивает версию патча
- Создает тег версии
- Отправляет изменения и теги в репозиторий

## Правила коммитов

Используем conventional commits:

- `feat:` - новая функциональность

```bash
git commit -m "feat: добавил форму логина"
```

- `fix:` - исправление ошибок

```bash
git commit -m "fix: исправил валидацию email"
```

- `chore:` - рутинные задачи, обновления

```bash
git commit -m "chore: обновил зависимости"
```

- `docs:` - документация

```bash
git commit -m "docs: обновил README"
```

## Версионность и коммиты

### Семантическое версионирование

Формат: `MAJOR.MINOR.PATCH` (например, 1.2.3)

- `MAJOR` - несовместимые изменения API
- `MINOR` - новая функциональность (обратно совместимая)
- `PATCH` - исправления багов

### Промежуточные коммиты в Dev

При работе над задачей в feature-ветке используйте промежуточные коммиты:

```bash
# Сохранение промежуточного прогресса
git commit -m "wip: описание текущего состояния"

# Сохранение логического блока изменений
git commit -m "feat(auth): добавил валидацию формы"

# Фиксация части большой задачи
git commit -m "feat(auth): #1 базовая структура компонентов"
git commit -m "feat(auth): #2 добавил стили"
git commit -m "feat(auth): #3 подключил апи"
```

### Объединение коммитов перед мержем

Перед мержем в dev желательно объединить промежуточные коммиты:

```bash
# Объединить последние N коммитов
git rebase -i HEAD~N

# Пример: объединить последние 3 коммита
git rebase -i HEAD~3
```

### Примеры версионирования

```bash
# Новая фича - увеличиваем MINOR
pnpm release "feat: добавили авторизацию" # 1.1.0

# Исправление бага - увеличиваем PATCH
pnpm release "fix: исправлен баг авторизации" # 1.1.1

# Большие изменения - увеличиваем MAJOR
pnpm release "feat!: новая версия API" # 2.0.0
```

### Рекомендации

- Делайте частые небольшие коммиты в процессе разработки
- Используйте префикс "wip:" для незавершенных изменений
- Объединяйте коммиты перед мержем в dev
- Пишите понятные описания коммитов
- Указывайте scope в круглых скобках, если нужно уточнить область изменений

### Работа с тегами версий

```bash
# Посмотреть все теги
git tag

# Посмотреть теги с описанием
git tag -n

# Создать тег с описанием
git tag -a v1.0.0 -m "Первый релиз"

# Запушить теги
git push --tags -
```
