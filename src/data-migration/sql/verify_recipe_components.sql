-- Verification: Check all product/prep codes exist in database

WITH component_codes AS (
  SELECT DISTINCT unnest(ARRAY[
    'A-1',
    'B-1',
    'B-2',
    'B-3',
    'C-10',
    'C-11',
    'C-12',
    'C-13',
    'C-16',
    'C-18',
    'C-19',
    'C-20',
    'C-21',
    'C-4',
    'C-6',
    'C-7',
    'C-8',
    'D-1',
    'D-11',
    'D-13',
    'D-14',
    'D-2',
    'D-3',
    'D-4',
    'D-5',
    'D-6',
    'D-7',
    'F-1',
    'F-4',
    'H-12',
    'H-13',
    'H-14',
    'H-15',
    'H-2',
    'H-3',
    'H-4',
    'H-5',
    'H-6',
    'H-7',
    'N-2',
    'O-11',
    'O-4',
    'O-5',
    'O-7',
    'O-8',
    'O-9',
    'P-1',
    'P-11',
    'P-12',
    'P-13',
    'P-14',
    'P-15',
    'P-16',
    'P-17',
    'P-18',
    'P-19',
    'P-2',
    'P-20',
    'P-21',
    'P-22',
    'P-23',
    'P-24',
    'P-25',
    'P-26',
    'P-27',
    'P-28',
    'P-3',
    'P-30',
    'P-33',
    'P-34',
    'P-35',
    'P-36',
    'P-37',
    'P-38',
    'P-39',
    'P-4',
    'P-40',
    'P-41',
    'P-42',
    'P-43',
    'P-44',
    'P-45',
    'P-49',
    'P-5',
    'P-6',
    'P-7',
    'P-8',
    'P-9',
    'R-1',
    'R-2',
    'R-3',
    'S-12',
    'S-13',
    'S-16',
    'S-19',
    'S-20',
    'S-3',
    'S-4',
    'S-6',
    'S-7',
    'S-9',
    'V-1',
    'V-10',
    'V-11',
    'V-12',
    'V-13',
    'V-15',
    'V-16',
    'V-17',
    'V-19',
    'V-2',
    'V-20',
    'V-21',
    'V-22',
    'V-24',
    'V-25',
    'V-26',
    'V-27',
    'V-28',
    'V-29',
    'V-30',
    'V-31',
    'V-32',
    'V-34',
    'V-35',
    'V-36',
    'V-37',
    'V-38',
    'V-40',
    'V-44',
    'V-5',
    'V-6',
    'V-7',
    'V-8'
  ]) AS code
),
preps AS (
  SELECT code FROM preparations WHERE code LIKE 'P-%'
),
prods AS (
  SELECT code FROM products
)
SELECT
  cc.code,
  CASE
    WHEN cc.code LIKE 'P-%' THEN 'preparation'
    ELSE 'product'
  END as expected_type,
  CASE
    WHEN preps.code IS NOT NULL THEN '✅ Found in preparations'
    WHEN prods.code IS NOT NULL THEN '✅ Found in products'
    ELSE '❌ Missing'
  END as status
FROM component_codes cc
LEFT JOIN preps ON cc.code = preps.code
LEFT JOIN prods ON cc.code = prods.code
ORDER BY cc.code;